<!-- ===========================================
     Contact Us View
     ===========================================
     This file serves as the home page of the web dashboard.
     Key actions:
     1. Include the necessary layout and partials.
     2. Display real-time data and user interactions.
     3. Ensure the page is styled consistently with the overall design.
     ===========================================
-->
<!-- Use the boilerplate layout for consistent structure it will retrieve the layout of the boilerplate file -->
<% layout('layouts/boilerplate') %>

<!-- contact-us Styles -->
<link rel="stylesheet" href="stylesheets/contact-us.css">

<section>
  <!-- Contact Form -->
  <div class="container">
    <div class="contact-form">
      <h3 class="text-center">CONTACT US</h3>
      <p class="text-center">Have a question or need assistance? We're here to help.</p>

      <!-- Check for success or error message and display it -->
      <% if (typeof successMessage !== 'undefined') { %>
        <div class="alert alert-success text-center">
          <%= successMessage %>
        </div>
      <% } %>

      <% if (typeof errorMessage !== 'undefined') { %>
        <div class="alert alert-danger text-center">
          <%= errorMessage %>
        </div>
      <% } %>

      <!-- Contact form for user input -->
      <form id="my-form" action="https://formspree.io/f/xeowevrq" method="POST">
        <div class="mb-3">
          <input type="text" name="name" class="form-control" placeholder="Name" required>
        </div>
        <div class="mb-3">
          <input type="email" name="email" class="form-control" placeholder="Email" required>
        </div>
        <div class="mb-3">
          <textarea name="message" class="form-control" placeholder="Message" rows="4" required></textarea>
        </div>
        <button id="my-form-button" type="submit" class="btn btn-primary w-100">Submit</button>
        <p id="my-form-status" class="text-center mt-3"></p>
      </form>
    </div>
    
  </div>
</section>

<script>
  var form = document.getElementById("my-form");
  
  async function handleSubmit(event) {
    event.preventDefault();
    var status = document.getElementById("my-form-status");
    var data = new FormData(event.target);
    fetch(event.target.action, {
      method: form.method,
      body: data,
      headers: {
          'Accept': 'application/json'
      }
    }).then(response => {
      if (response.ok) {
        status.innerHTML = "Thanks for your submission!";
        status.classList.add('text-success');
        status.classList.remove('text-danger');
        form.reset()
      } else {
        response.json().then(data => {
          if (Object.hasOwn(data, 'errors')) {
            status.innerHTML = data["errors"].map(error => error["message"]).join(", ")
          } else {
            status.innerHTML = "Oops! There was a problem submitting your form"
          }
          status.classList.add('text-danger');
          status.classList.remove('text-success');
        })
      }
    }).catch(error => {
      status.innerHTML = "Oops! There was a problem submitting your form"
      status.classList.add('text-danger');
      status.classList.remove('text-success');
    });
  }
  form.addEventListener("submit", handleSubmit)
</script>
